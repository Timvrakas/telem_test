<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Telem_Test</title>

	<!--<script language="javascript" type="text/javascript" src="../../source/jquery.canvaswrapper.js"></script>
	<script language="javascript" type="text/javascript" src="../../source/jquery.colorhelpers.js"></script> -->
	<script language="javascript" type="text/javascript" src="jquery.flot.js"></script>
	<!--<script language="javascript" type="text/javascript" src="../../source/jquery.flot.saturated.js"></script>
	<script language="javascript" type="text/javascript" src="../../source/jquery.flot.browser.js"></script>
	<script language="javascript" type="text/javascript" src="../../source/jquery.flot.drawSeries.js"></script>
	<script language="javascript" type="text/javascript" src="../../source/jquery.flot.uiConstants.js"></script> -->
	<script type="text/javascript">

	$(function() {

		// We use an inline data source in the example, usually data would
		// be fetched from a server

		var data = [],
			totalPoints = 300;

		function getRandomData() {
			return nums;
		}

        nums = []

        $.ajax({
            type: "POST",
            url: "http://localhost:8000/register",
            contentType: "application/json",
            data: JSON.stringify({ "user_id": 1 })
        }).done(function (data, textStatus, jqXHR) {
            url = 'ws://localhost:8000/ws/' + data.uuid;
            console.log(url)
            webSocket = new WebSocket(url);
            webSocket.onmessage = function (event) {
                parsed = JSON.parse(event.data)
                if ("sensor.tick" in parsed){
                    x = parsed["sensor.adxl1.a.0"]
                    t = parsed["sensor.tick"]
                    nums.push([t,x])
                    if(nums.length > 1000){
                         nums.splice(0,1)
                    }
                    $("#result" ).text(nums.length)
                }
                
            }
        });




		var updateInterval = 30;

		var plot = $.plot("#placeholder", [ getRandomData() ], {
			series: {
                shadowSize: 0	// Drawing is faster without shadows
			},
			xaxis: {
				show: true
			}
		});

		function update() {

			plot.setData([getRandomData()]);

			// Since the axes don't change, we don't need to call plot.setupGrid()

			plot.draw();
            plot.setupGrid(true)
			setTimeout(update, updateInterval);
		}

		update();

	});

	</script>
</head>
<body>
    <h2>This is a Telem Test</h2>
    <div id="placeholder" style="width:600px;height:300px"></div>
    <div id="result"></div>
</body>
</html>